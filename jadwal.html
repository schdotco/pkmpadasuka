<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üóìÔ∏è Setting Jadwal Pegawai - Puskesmas Padasuka</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
    }

    /* NAVBAR */
    .navbar {
      background: #1976d2;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 20px;
    }
    .navbar h1 {
      font-size: 18px;
      margin: 0;
    }
    .navbar .menu {
      display: flex;
      gap: 15px;
    }
    .navbar .menu a {
      color: #fff;
      text-decoration: none;
      font-size: 14px;
    }
    .navbar .menu a:hover {
      text-decoration: underline;
    }
    .navbar button {
      background: #fff;
      color: #1976d2;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }

    /* MAIN CONTAINER */
    main {
      max-width: 1100px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    h2 {
      font-size: 20px;
      color: #1976d2;
      margin-top: 0;
      border-bottom: 2px solid #1976d2;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }

    label {
      font-size: 14px;
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
      color: #333;
    }

    input[type="date"],
    input[type="text"],
    select {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      background: #fafafa;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .section {
      margin-top: 30px;
    }

    .dropdown-group {
      margin-bottom: 20px;
    }

    .dropdown-row select {
      margin-bottom: 8px;
      display: block;
    }

    button.save-btn {
      background: #1976d2;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 20px;
    }
    button.save-btn:hover {
      background: #125ca1;
    }

    .btn-secondary {
      background: #555;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      margin-left: 10px;
      cursor: pointer;
    }
    .btn-secondary:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>üèõÔ∏è Data & Informasi UPTD Puskesmas Padasuka</h1>
    <div class="menu">
      <a href="dashboard.html">Dashboard</a>
      <a href="profil.html">Profil</a>
      <a href="#">Pengumuman</a>
      <a href="#">Kehadiran</a>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <main>
    <h2>üóìÔ∏è Setting Jadwal Pegawai</h2>

    <!-- Informasi Umum -->
    <div class="form-grid">
      <div>
        <label for="jadwalTanggal">Tanggal</label>
        <input type="date" id="jadwalTanggal">
      </div>
      <div>
        <label for="dressCode">Dress Code</label>
        <input type="text" id="dressCode" placeholder="Contoh: Batik / Seragam Putih">
      </div>
      <div>
        <label for="pembina">Pembina Stand up Briefing (Pukul 07.30)</label>
        <select id="pembina">
          <option value="">-- Pilih Pembina --</option>
        </select>
      </div>
    </div>

    <!-- Kegiatan Dalam Gedung -->
    <div class="section">
      <h2>I. Kegiatan Dalam Gedung</h2>

      <div class="dropdown-group">
        <label>Screening CKG (5 Pegawai)</label>
        <div class="dropdown-row" id="screeningCKG"></div>
      </div>

      <div class="dropdown-group">
        <label>Pendaftaran & Skrining BPJS (5 Pegawai)</label>
        <div class="dropdown-row" id="bpjs"></div>
      </div>

      <div class="dropdown-group">
        <label>Rekam Medis (5 Pegawai)</label>
        <div class="dropdown-row" id="rekamMedis"></div>
      </div>

      <div class="dropdown-group">
        <label>Pusat Informasi & Rujukan (1 Pegawai)</label>
        <div class="dropdown-row" id="pusatInformasi"></div>
      </div>
    </div>

    <!-- Kegiatan Luar Gedung -->
    <div class="section">
      <h2>II. Kegiatan Luar Gedung</h2>

      <div class="dropdown-group">
        <label>Posyandu (10 Pegawai)</label>
        <div class="dropdown-row" id="posyandu"></div>
      </div>

      <div class="dropdown-group">
        <label>Rapat & Pelatihan (30 Pegawai)</label>
        <div class="dropdown-row" id="rapat"></div>
      </div>
    </div>

    <button id="btnSimpanJadwal" class="save-btn">üíæ Simpan Jadwal</button>
    <button onclick="window.location.href='hasil-jadwal.html'" class="btn-secondary">üìÑ Lihat Jadwal</button>
  </main>

  <script type="module">
    import { db } from './app.js';
    import { ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

    const pembinaSelect = document.getElementById('pembina');
    let pegawaiList = [];

    // Ambil data pegawai dari Firebase (pegawai.html)
    const pegawaiRef = ref(db, 'pegawai');
    onValue(pegawaiRef, (snapshot) => {
      pegawaiList = [];
      pembinaSelect.innerHTML = `<option value="">-- Pilih Pembina --</option>`;
      snapshot.forEach(child => {
        const data = child.val();
        const namaLengkap = data.gelar ? `${data.gelar} ${data.nama}` : data.nama;
        pegawaiList.push(namaLengkap);
        const opt = document.createElement('option');
        opt.value = namaLengkap;
        opt.textContent = namaLengkap;
        pembinaSelect.appendChild(opt);
      });

      // Setelah list pegawai didapat ‚Üí generate semua dropdown
      generateDropdowns();
    });

    function generateDropdowns() {
      createDropdown(5, "screeningCKG");
      createDropdown(5, "bpjs");
      createDropdown(5, "rekamMedis");
      createDropdown(1, "pusatInformasi");
      createDropdown(10, "posyandu");
      createDropdown(30, "rapat");
    }

    function createDropdown(jumlah, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      for (let i = 0; i < jumlah; i++) {
        const select = document.createElement("select");
        const optDefault = document.createElement("option");
        optDefault.value = "";
        optDefault.textContent = `-- Pegawai ${i+1} --`;
        select.appendChild(optDefault);

        pegawaiList.forEach(nama => {
          const opt = document.createElement("option");
          opt.value = nama;
          opt.textContent = nama;
          select.appendChild(opt);
        });
        container.appendChild(select);
      }
    }

    // Simpan Jadwal ke Firebase
    document.getElementById('btnSimpanJadwal').addEventListener('click', () => {
      const tanggal = document.getElementById('jadwalTanggal').value;
      const dressCode = document.getElementById('dressCode').value;
      const pembina = pembinaSelect.value;

      if (!tanggal || !dressCode || !pembina) {
        alert('Mohon lengkapi semua data utama!');
        return;
      }

      const dataJadwal = {
        tanggal,
        dressCode,
        pembina,
        dibuatPada: new Date().toISOString()
      };

      const jadwalRef = ref(db, 'jadwal');
      const newRef = push(jadwalRef);

      set(newRef, dataJadwal)
        .then(() => {
          alert('‚úÖ Jadwal berhasil disimpan!');
          window.location.href = 'hasil-jadwal.html';
        })
        .catch(err => alert('‚ùå Gagal menyimpan jadwal: ' + err.message));
    });
  </script>
</body>
</html>
