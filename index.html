<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title> Data & Informasi UPTD Puskesmas Padasuka </title>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      font-family: "Segoe UI", Arial, sans-serif; 
      background: #f4f7fa; 
      color: #333; 
    }

    header { 
      background: #1976d2; 
      color: white; 
      padding: 15px; 
      text-align: center; 
      font-size: 1.2rem;
      font-weight: bold;
    }

    main {
      display: flex;
      flex-wrap: wrap;
      min-height: calc(100vh - 60px);
    }

    /* Bagian kiri */
    .left-panel {
      flex: 1;
      background: #1976d2;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
      min-width: 280px;
    }
    .left-panel h1 {
      font-size: 1.8rem;
      margin-bottom: 15px;
      text-align: center;
    }
    .left-panel p {
      font-size: 0.95rem;
      max-width: 400px;
      text-align: center;
      line-height: 1.5;
    }
    .left-panel img {
      margin-top: 30px;
      width: 180px;
      max-width: 90%;
    }

    /* Bagian kanan (form login/register/dashboard) */
    .right-panel {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
      min-width: 300px;
    }

    .card {
      background: white;
      padding: 30px 25px;
      border-radius: 10px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h3 {
      text-align: center;
      margin-bottom: 20px;
      color: #1976d2;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    button {
      background: #1976d2;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #125aa0;
    }

    .link {
      text-align: center;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .link a {
      color: #1976d2;
      text-decoration: underline;
      cursor: pointer;
    }

    .hidden { display: none; }

    /* Dashboard */
    #dashboard .card {
      max-width: 700px;
      margin: 15px auto;
    }

    @media (max-width: 768px) {
      main { flex-direction: column; }
      .left-panel { padding: 20px; }
      .left-panel h1 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <header>Data & Informasi UPTD Puskesmas Padasuka<</header>

  <main>
    <!-- Panel kiri -->
    <div class="left-panel">
      <h1>Satu Akses Untuk Semua</h1>
      <p>
        Portal internal untuk pengelolaan <b>Data & Informasi UPTD Puskesmas Padasuka</b>.  
        Akses cepat dan mudah langsung dari browser Anda.
      </p>
      <img src="https://cdn-icons-png.flaticon.com/512/2922/2922506.png" alt="Ilustrasi Login">
    </div>

    <!-- Panel kanan -->
    <div class="right-panel">
      <!-- LOGIN -->
      <div id="loginCard" class="card">
        <h3>Login</h3>
        <input type="email" id="loginEmail" placeholder="Email"/>
        <input type="password" id="loginPassword" placeholder="Password"/>
        <button onclick="loginUser()">Masuk</button>
        <div class="link">Belum punya akun? <a onclick="showRegister()">Daftar</a></div>
      </div>

      <!-- REGISTER -->
      <div id="registerCard" class="card hidden">
        <h3>Registrasi</h3>
        <input type="text" id="regName" placeholder="Nama Lengkap" />
        <input type="email" id="regEmail" placeholder="Email" />
        <input type="password" id="regPassword" placeholder="Password" />
        <label><input type="checkbox" id="regIsAdmin"> Daftar sebagai admin</label>
        <button onclick="registerUser()">Daftar</button>
        <div class="link">Sudah punya akun? <a onclick="showLogin()">Login</a></div>
      </div>

      <!-- DASHBOARD -->
      <div id="dashboard" class="hidden" style="width:100%">
        <div class="card">
          <h3 id="welcomeText">Selamat datang</h3>
          <button onclick="logoutUser()">Logout</button>
        </div>

        <div class="card" id="jadwalCard">
          <h3>Jadwal Hari Ini</h3>
          <div id="jadwalData">Memuat...</div>
        </div>

        <div class="card">
          <h3>Pengajuan Cuti</h3>
          <input type="date" id="cutiMulai" />
          <input type="date" id="cutiSelesai" />
          <input type="text" id="cutiAlasan" placeholder="Alasan cuti" />
          <button onclick="ajukanCuti()">Ajukan</button>
          <div id="statusCuti"></div>
        </div>

        <div class="card hidden" id="adminPanel">
          <h3>Panel Admin</h3>
          <button onclick="muatPengajuan()">Muat Pengajuan Cuti</button>
          <div id="listPengajuan"></div>
          <hr>
          <h4>Tambah Jadwal Karyawan</h4>
          <input type="text" id="jadwalUid" placeholder="UID Karyawan" />
          <input type="text" id="jadwalKegiatan" placeholder="Kegiatan Hari Ini" />
          <button onclick="tambahJadwal()">Simpan Jadwal</button>
        </div>
      </div>
    </div>
  </main>

  <!-- ðŸ§  Firebase Script tetap sama -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { 
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut 
    } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { 
      getDatabase, ref, set, get, child, update, onValue 
    } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDciAiNKFbh8aoM8joIywSeH9Boml1tK5s",
      authDomain: "aplikasi-jadwal-1d54d.firebaseapp.com",
      databaseURL: "https://aplikasi-jadwal-1d54d-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "aplikasi-jadwal-1d54d",
      storageBucket: "aplikasi-jadwal-1d54d.firebasestorage.app",
      messagingSenderId: "860941812271",
      appId: "1:860941812271:web:458bd63c5b0d2514fcbcda"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginCard = document.getElementById('loginCard');
    const registerCard = document.getElementById('registerCard');
    const dashboard = document.getElementById('dashboard');
    const adminPanel = document.getElementById('adminPanel');
    const welcomeText = document.getElementById('welcomeText');

    function showRegister() {
      loginCard.classList.add('hidden');
      registerCard.classList.remove('hidden');
    }
    window.showRegister = showRegister;

    function showLogin() {
      registerCard.classList.add('hidden');
      loginCard.classList.remove('hidden');
    }
    window.showLogin = showLogin;

    async function registerUser() {
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const isAdmin = document.getElementById('regIsAdmin').checked;

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await set(ref(db, 'users/' + user.uid), {
          name: name,
          email: email,
          isAdmin: isAdmin
        });
        alert('Registrasi berhasil! Silakan login.');
        showLogin();
      } catch (error) {
        alert(error.message);
      }
    }
    window.registerUser = registerUser;

    async function loginUser() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        loadDashboard(user);
      } catch (error) {
        alert('Login gagal: ' + error.message);
      }
    }
    window.loginUser = loginUser;

    async function loadDashboard(user) {
      loginCard.classList.add('hidden');
      registerCard.classList.add('hidden');
      dashboard.classList.remove('hidden');
      const snapshot = await get(child(ref(db), 'users/' + user.uid));
      if (snapshot.exists()) {
        const data = snapshot.val();
        welcomeText.textContent = `Selamat datang, ${data.name}`;
        if (data.isAdmin) adminPanel.classList.remove('hidden');
        muatJadwal(user.uid);
        cekCuti(user.uid);
      }
    }

    async function logoutUser() {
      await signOut(auth);
      dashboard.classList.add('hidden');
      loginCard.classList.remove('hidden');
    }
    window.logoutUser = logoutUser;

    async function ajukanCuti() {
      const mulai = document.getElementById('cutiMulai').value;
      const selesai = document.getElementById('cutiSelesai').value;
      const alasan = document.getElementById('cutiAlasan').value;
      const user = auth.currentUser;
      if (!user) return;

      const newId = Date.now();
      await set(ref(db, 'leaves/' + newId), {
        uid: user.uid,
        mulai: mulai,
        selesai: selesai,
        alasan: alasan,
        status: 'Menunggu'
      });
      alert('Pengajuan cuti dikirim!');
    }
    window.ajukanCuti = ajukanCuti;

    async function muatPengajuan() {
      const container = document.getElementById('listPengajuan');
      container.innerHTML = '';
      const snapshot = await get(child(ref(db), 'leaves'));
      if (snapshot.exists()) {
        const data = snapshot.val();
        for (let id in data) {
          const item = data[id];
          const div = document.createElement('div');
          div.style.margin = '8px 0';
          div.innerHTML = `<b>${item.alasan}</b> (${item.mulai} - ${item.selesai}) - ${item.status}
            <button onclick="ubahStatus('${id}','Disetujui')">Setujui</button>
            <button onclick="ubahStatus('${id}','Ditolak')">Tolak</button>`;
          container.appendChild(div);
        }
      }
    }
    window.muatPengajuan = muatPengajuan;

    window.ubahStatus = async function(id, status) {
      await update(ref(db, 'leaves/' + id), { status: status });
      alert('Status diperbarui menjadi ' + status);
      muatPengajuan();
    }

    async function tambahJadwal() {
      const uid = document.getElementById('jadwalUid').value;
      const kegiatan = document.getElementById('jadwalKegiatan').value;
      await set(ref(db, 'schedules/' + uid + '/today'), {
        kegiatan: kegiatan,
        tanggal: new Date().toISOString().slice(0,10)
      });
      alert('Jadwal ditambahkan!');
    }
    window.tambahJadwal = tambahJadwal;

    async function muatJadwal(uid) {
      const dataDiv = document.getElementById('jadwalData');
      const snapshot = await get(child(ref(db), 'schedules/' + uid + '/today'));
      if (snapshot.exists()) {
        const jadwal = snapshot.val();
        dataDiv.textContent = `${jadwal.tanggal}: ${jadwal.kegiatan}`;
      } else {
        dataDiv.textContent = 'Tidak ada jadwal untuk hari ini';
      }
    }

    function cekCuti(uid) {
      const statusDiv = document.getElementById('statusCuti');
      onValue(ref(db, 'leaves'), (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          let aktif = [];
          for (let id in data) {
            const item = data[id];
            if (item.uid === uid && item.status === 'Disetujui') {
              const today = new Date().toISOString().slice(0,10);
              if (today >= item.mulai && today <= item.selesai) aktif.push(item);
            }
          }
          if (aktif.length > 0) statusDiv.textContent = 'Sedang cuti';
          else statusDiv.textContent = 'Tidak sedang cuti';
        }
      });
    }
  </script>
</body>
</html>
